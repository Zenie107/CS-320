name: Update README Links

on:
  push:
    paths:
      - '**/*.html' # Only runs when HTML files are changed/added

jobs:
  build:
    runs-on: ubuntu-latest
    permissions:
      contents: write # Allows the action to push changes back to your repo

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Generate Links
        run: |
          # Get your username and repo name
          USER=$(echo ${{ github.repository }} | cut -d'/' -f1)
          REPO=$(echo ${{ github.repository }} | cut -d'/' -f2)
          
          echo "### ðŸ”— Project Links" > links.txt
          
          # Find all html files, excluding index.html if you prefer
          find . -name "*.html" ! -name "index.html" | while read file; do
            # Clean path (remove ./)
            CLEAN_PATH=$(echo $file | sed 's|^\./||')
            # Create the URL
            URL="https://$USER.github.io/$REPO/$CLEAN_PATH"
            # Add to the list
            echo "* [$CLEAN_PATH]($URL)" >> links.txt
          done

      - name: Update README
        run: |
          # Use sed to replace the content between the markers
          sed -i '//,//{ //!{ //!d; }; }' README.md
          sed -i '//r links.txt' README.md

      - name: Commit and Push
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          git add README.md
          git commit -m "docs: update navigation links in README" || exit 0
          git push
